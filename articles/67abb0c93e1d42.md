---
title: "Remixã¨Vite"
emoji: "â¤ï¸"
type: "tech"
topics:
  - "react"
  - "typescript"
  - "vite"
  - "remix"
published: true
published_at: "2023-11-01 15:56"
---

# ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯2023/11/1æ™‚ç‚¹ã®æƒ…å ±ã§ã™ã€‚Viteã®ã‚µãƒãƒ¼ãƒˆã¯ç¾åœ¨ Unstalbe ã§ã‚ã‚‹ç‚ºä»Šå¾Œä»•æ§˜ãªã©ãŒå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€ç¾æ™‚ç‚¹ã§Viteã‚’æœ¬ç•ªç’°å¢ƒã«ä½¿ã†ã“ã¨ã¯ãŠå‹§ã‚ã§ãã¾ã›ã‚“ã€‚äºˆã‚ãã®ç‚¹ã‚’ã”ç†è§£ã®ä¸Šèª­ã‚“ã§ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚

:::details CHANGELOG
2023/11/03

- å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã¦èµ·ããŸå•é¡Œã‚’è¿½åŠ 
- ç§»è¡Œæ–¹æ³•ã«è¨˜äº‹ä½œæˆæ™‚ã«ã¯ç„¡ã‹ã£ãŸå‹•ç”»ã‚’è¿½åŠ 
:::

## ç°¡å˜ãªã¾ã¨ã‚

1. HMR ã‚„HDR ãŒé€Ÿããªã‚‹ã‚ˆï¼
2. Vite ã®æ©Ÿèƒ½ã‚„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä½¿ç”¨ã§ãã‚‹ï¼
2.1. Remix ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ç„¡ã„æ©Ÿèƒ½ã¯Vite ã‚’æ’ä»–çš„ã«ä½¿ã†å ´åˆã«ã ã‘ä½¿ã£ã¦ã­ï¼
2.2. MDXã¨ã‹ãŒVite ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã†ã“ã¨ã§ç°¡å˜ã«ä½¿ãˆã‚‹ã‚ˆã†ã«ï¼

## ViteãŒä½¿ãˆã‚‹é­…åŠ›

Viteã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€è¿½åŠ ã®ãƒãƒ³ãƒ‰ãƒ«æ©Ÿèƒ½ã«[Viteã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³](https://www.youtube.com/watch?v=B_vIp4xETl4&t=3s)ã‚’ä½¿ç”¨ã§ãã‚‹ç‚¹ã§ã™ã€‚ã¾ãŸã€MDXãªã©ãŒViteã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ç°¡å˜ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯ãƒ–ãƒ­ã‚°ãªã©ã‚’ä½œæˆã™ã‚‹éš›ã«ã‹ãªã‚Šå½¹ç«‹ã¡ãã†ã ãªã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚

æœ€å¾Œã«ã‚„ã¯ã‚ŠViteã®HMRãªã©ã¯éå¸¸ã«å„ªç§€ã§ã€å…ƒã‹ã‚‰è‰¯ã‹ã£ãŸé–‹ç™ºè€…ä½“é¨“ãŒã‚ˆã‚Šè‰¯ããªã‚‹ã¨æ€ã„ã¾ã™ã€‚å®Ÿéš›Remixå…¬å¼ãƒ–ãƒ­ã‚°ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ¤œè¨¼çµæœãŒã‚ã‚Šã¾ã—ãŸã®ã§ã€å¼•ç”¨ã—ã¾ã™ã€‚

> So how fast is lightning fast âš¡ï¸? Well, we did some quick testing on the [Indie Stack](https://github.com/remix-run/indie-stack) with a M1 Max MacBook Pro and hereâ€™s what we found:
>
> 10x faster HMR ğŸ”¥
5x faster [HDR](https://www.youtube.com/watch?v=2c2OeqOX72s) ğŸ”¥

HMRãŒ10xã«ãªã‚‹ã¨ã®ã“ã¨ã§ã‹ãªã‚ŠæœŸå¾…ã—ã¦ã¾ã™ã€‚

â€»HDRã¯ Hot Data Revalidationã®ã“ã¨ã§ã™


## è©¦ã—ã¦ã¿ã‚‹

æœ€å°é™ã®æ§‹æˆã¯ `unstable-vite` ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```bash
npx create-remix@latest --template remix-run/remix/templates/unstable-vite
```

ã‚µãƒ¼ãƒãƒ¼ã‚’ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹å ´åˆã¯ `unstable-vite-express` ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒä½¿ç”¨ã§ãã¾ã™
```bash
npx create-remix@latest --template remix-run/remix/templates/unstable-vite-express
```

## ç§»è¡Œã™ã‚‹

ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚

https://remix.run/docs/en/main/future/vite#migrating

ã¾ãŸã€å‹•ç”»ã§ã®ç§»è¡Œã‚¬ã‚¤ãƒ‰ã‚‚ã‚ã‚‹ã®ã§ãã¡ã‚‰ã‚‚å‚è€ƒã«ã—ã¦ã¿ã‚‹ã¨ã‚ˆã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ï¼ˆ2023/11/03è¿½è¨˜ï¼‰

https://www.youtube.com/watch?v=g60FI9Oyfs4

## æ°—ã‚’ä»˜ã‘ã‚‹ã“ã¨

Remixã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã¯å…ƒã€…ãƒ‘ã‚¹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãªã©ã‚’ `tsconfig.json` ã® `paths` ç­‰ã‹ã‚‰è§£æ±ºã—ã¦ãã‚Œã¾ã™ãŒã€Viteã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ `vite-tsconfig-paths` ç­‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã«ä¼¼ãŸå•é¡Œã¨ã—ã¦ã€Vite ã‚’ä½¿ã†ã“ã¨ã§Remix ãã®ã‚‚ã®ã«ã¤ã„ã¦å­¦ã¶ã“ã¨ãŒæ¸›ã‚‹ä»£ã‚ã‚Šã«Vite ã«ã¤ã„ã¦ã®çŸ¥è­˜ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚Vite ã«ã¯Remix ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã¯çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„å¤šãã®æ©Ÿèƒ½ãŒã‚ã‚Šã€ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã¨Remix ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒã‚¢ãƒ—ãƒªã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§ããªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ä»Šå¾Œã‚‚Vite ã‚’æ’ä»–çš„ã«ä½¿ç”¨ã™ã‚‹å ´åˆã®ã¿ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚


## å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã¦èµ·ããŸå•é¡Œã¨ãã®è§£æ±ºç­–

### pnpmã®workspaceã‚’ä½¿ã£ã¦ã„ã‚‹éš›ã«ã‚¨ãƒ³ãƒˆãƒªãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

pnpmã®workspaceã‚’ä½¿ã£ã¦ã„ã‚‹çŠ¶æ…‹ã§ `pnpm dev` ã‚’ä½¿ã£ãŸã¨ã“ã‚ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€‚

```
8:52:16 [vite] Internal server error: Cannot resolve asset path "C:\Users\yupix\Desktop\work\demo\node_modules\.pnpm\@remix-run+dev@2.2.0_@remix-run+serve@2.2.0_typescript@5.2.2_vite@4.5.0\node_modules\@remix-run\dev\dist\config\defaults\entry.server.node.tsx" outside of root directory "C:\Users\yupix\Desktop\work\demo\packages\frontend".
```

ã©ã†ã‚„ã‚‰ `entry.server.tsx` ãªã©ãŒç„¡ã„ã“ã¨ãŒå•é¡Œã®ã‚ˆã†ã§ã™ã€‚ä¸€å¿œä¿®æ­£æ–¹æ³•ã¨ã—ã¦ã¯ä¸‹è¨˜ã«ã‚ã‚‹Issueã«ã‚ã£ãŸ `pnpm remix reveal` ã§ `entry.server.tsx` ã¨ `entry.client.tsx` ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§è§£æ±ºã§ãã¾ã™ã€‚

https://github.com/remix-run/remix/issues/7722

### .envã‹ã‚‰ `process.env.*`ã§ ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿å–ã‚Œãªã„

ã¦ã£ãã‚Š `import.meta.env.*` ã«ã—ãªã„ã¨ãƒ€ãƒ¡ãªã®ã‹ãªã¨æ€ã£ãŸã‚Šã—ãŸã®ã§ã™ãŒã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚³ãƒ¼ãƒ‰ç”¨ã® `VITE_` prefixã‚’ä»˜ã‘ãŸç‰©ã—ã‹å‹•ä½œã—ã¾ã›ã‚“ã§ã—ãŸã€‚

æ­£ã—ã„æ–¹æ³•ã¨ã—ã¦ã¯ `*.server.ts` ç­‰ã®ã‚µãƒ¼ãƒãƒ¼ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ [`dotenv`](https://www.npmjs.com/package/dotenv) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’importã™ã‚‹ã“ã¨ã®ã‚ˆã†ã§ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯å…¥ã£ã¦ã„ãªã„ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash
pnpm add dotenv
```

å˜ç´”ã«ç’°å¢ƒå¤‰æ•°ã‚’èª­ã¿å–ã‚‹ã ã‘ã§ã¯ãªãzodã‚’ä½¿ã£ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚ã—ã¦ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ä»Šã¾ã§é€šã‚Š `process.env.*` å½¢å¼ã§å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts:env.server.ts
import 'dotenv/config'  // å…ˆé ­ã«è¿½åŠ ã™ã‚‹
import { z } from "zod";

const schema  = z.object({
    NODE_ENV: z.enum(["development", "production", "test"] as const),
})

declare global {
    namespace NodeJS {
        interface ProcessEnv extends z.infer<typeof schema> {}
    }
}

export function init() {
    const parsed = schema.safeParse(process.env);

    if (parsed.success === false) {
        console.error('Invalid environment variables: ', parsed.error.flatten().fieldErrors);
        throw new Error('Invalid environment variables');
    }
}
```

#### é–¢é€£ã™ã‚‹ Discussion ã‚„ Pull request

ã“ã®å•é¡Œã®è§£æ±ºç­–ã«ã¤ã„ã¦æ›¸ã‹ã‚ŒãŸDiscussion
https://github.com/remix-run/remix/discussions/7875

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«envã«ã¤ã„ã¦è¿½åŠ ã™ã‚‹PR
https://github.com/remix-run/remix/pull/7879

## å®Ÿéš›ã«ä½œã£ã¦ã‚‹æœ€ä¸­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

ä¸€å¿œRemixã§ä½œã£ã¦ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã„ã‚ã„ã‚ã‚ã‚‹ã‚“ã§ã™ãŒã€æµçŸ³ã«unstableãªç‰©ã«ç§»è¡Œã™ã‚‹å‹‡æ°—ã¯ç„¡ã„ã®ã§ã€å€‹äººãƒ–ãƒ­ã‚°ä½œã£ã¦ã¿ã¾ã—ãŸã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã¾ãŸå¾Œæ—¥åˆ¥ã®è¨˜äº‹ã‚’æ›¸ãã¤ã‚‚ã‚Šã§ã™ãŒã€æ§‹æˆã¨ã—ã¦ã¯ Remix(Vite) + Strapi + shadcn/ui(Tailwind CSS)ã¨ã„ã†å½¢ã§ã™ã€‚Strapiã¯CMSã¨ã—ã¦ä½¿ã£ã¦ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯è¨˜äº‹ã§è§¦ã‚ŒãŸMDXãªã©ã®æ©Ÿèƒ½ã¯ä½¿ã£ã¦ã¾ã›ã‚“ã€‚~~ã»ã¨ã‚“ã©Viteã®é€Ÿã•ç›®çš„ã§ã™~~ã€‚

https://github.com/yupix/yupix.me


## çµ‚ã‚ã‚Šã«

Vite ã«é–¢ã™ã‚‹æ©Ÿèƒ½ã¯ `v2.2.0` ã‹ã‚‰ä½¿ç”¨ã§ãã¾ã™ã€‚ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
ã“ã“ã¾ã§èª­ã‚“ã§ãã ã•ã‚Šã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

## å‚è€ƒ

https://remix.run/docs/en/main/future/vite
https://www.youtube.com/watch?v=B_vIp4xETl4